/**
 * usePhraseCycler Hook
 * 管理加载时显示的幽默短语循环
 *
 * 功能：
 * - 140 条中国风/武侠/修仙短语
 * - 每 15 秒自动切换
 * - 5/6 概率显示幽默短语，1/6 概率显示实用提示
 */

import { useEffect, useState } from 'react';

// 切换间隔：15 秒
const PHRASE_CHANGE_INTERVAL_MS = 15000;

/**
 * 幽默短语列表 - 中国风/武侠/修仙主题
 */
export const WITTY_LOADING_PHRASES = [
  // 修仙风格 (40条)
  '正在推演天机...',
  '炼化灵气中...',
  '参悟道法...',
  '渡劫中，请勿打扰...',
  '凝聚元神...',
  '破境突破中...',
  '炼制丹药...',
  '布置法阵...',
  '祭炼法宝...',
  '感悟天道...',
  '凝练真元...',
  '炼化天材地宝...',
  '闭关修炼中...',
  '悟道于混沌之中...',
  '吸收日月精华...',
  '炼神还虚...',
  '天人合一...',
  '掐指一算...',
  '施展神通...',
  '驱动灵力...',
  '炼化雷劫...',
  '凝聚道果...',
  '洗髓伐毛...',
  '筑基成功在即...',
  '元婴出窍...',
  '化神归位...',
  '渡劫飞升准备中...',
  '炼化仙丹...',
  '感应天地灵气...',
  '修复经脉...',
  '开辟丹田...',
  '凝聚金丹...',
  '破碎虚空...',
  '逆转乾坤...',
  '炼化混沌...',
  '感悟轮回...',
  '参透生死...',
  '炼制仙器...',
  '布下天罗地网...',
  '破解封印中...',

  // 武侠风格 (40条)
  '施展轻功...',
  '破解阵法...',
  '参研武学...',
  '打通任督二脉...',
  '调息运功中...',
  '飞剑传书...',
  '翻阅武林秘籍...',
  '练习剑法...',
  '内力运转中...',
  '破解机关...',
  '追踪线索...',
  '寻找宝藏...',
  '参悟剑意...',
  '修炼内功...',
  '凝聚真气...',
  '施展身法...',
  '破解招式...',
  '研习掌法...',
  '炼化真元...',
  '打坐入定...',
  '感悟剑道...',
  '参透拳理...',
  '修炼神功...',
  '破解毒术...',
  '炼制解药...',
  '施展暗器...',
  '破解暗器...',
  '参研易容术...',
  '施展轻功水上漂...',
  '修炼乾坤大挪移...',
  '参悟降龙十八掌...',
  '练习九阴真经...',
  '研习葵花宝典...',
  '破解辟邪剑法...',
  '施展凌波微步...',
  '参悟独孤九剑...',
  '修炼太极拳...',
  '炼化六脉神剑...',
  '破解玄铁剑法...',
  '施展北冥神功...',

  // 中国风格 (40条)
  '观星测算...',
  '翻阅古籍...',
  '推演八卦...',
  '占卜吉凶...',
  '研习易经...',
  '参悟周易...',
  '推算命理...',
  '破解谜题...',
  '寻找线索...',
  '考据文献...',
  '参研典籍...',
  '破译古文...',
  '鉴定文物...',
  '研究史料...',
  '推敲诗词...',
  '参悟书法...',
  '研习画作...',
  '鉴赏古玩...',
  '参研茶道...',
  '修炼琴艺...',
  '参悟棋局...',
  '研习书画...',
  '破解机括...',
  '研究医术...',
  '炼制草药...',
  '配置方剂...',
  '施针治病...',
  '参研针灸...',
  '修炼气功...',
  '参悟太极...',
  '研习八卦...',
  '推演五行...',
  '参研阴阳...',
  '破解风水...',
  '施展奇门遁甲...',
  '参悟天干地支...',
  '推算节气...',
  '观测天象...',
  '破解星象...',
  '参研历法...',

  // 日常风格 (20条)
  '煮茶论道...',
  '品茗赏月...',
  '抚琴吟诗...',
  '挥毫泼墨...',
  '对弈论禅...',
  '焚香静坐...',
  '抄经念佛...',
  '舞剑习武...',
  '酿酒品酒...',
  '赏花弄柳...',
  '听雨观云...',
  '登高望远...',
  '临摹碑帖...',
  '雕刻印章...',
  '制香调香...',
  '烹饪美食...',
  '酿造仙酿...',
  '炼制法器...',
  '打造神兵...',
  '修缮宝物...',
];

/**
 * 实用提示信息
 */
export const INFORMATIVE_TIPS = [
  'Esc - 停止任务',
  'Shift+Tab - 切换权限模式',
  '/theme - 切换主题',
  '/resume - 恢复历史会话',
  '双击 Esc - 清空输入',
  '/permissions - 管理权限规则',
  '/help - 查看帮助信息',
  'Tab - 补全斜杠命令',
  '↑↓ - 浏览命令历史',
  '/config - 查看配置信息',
];

/**
 * usePhraseCycler Hook
 *
 * @param isActive - 是否激活短语循环（通常在 Agent 处理中时为 true）
 * @param isWaiting - 是否等待用户确认（显示固定等待文本）
 * @returns 当前显示的短语
 */
export function usePhraseCycler(isActive: boolean, isWaiting: boolean): string {
  const [currentPhrase, setCurrentPhrase] = useState<string>('');

  useEffect(() => {
    // 等待确认时显示固定文本
    if (isWaiting) {
      setCurrentPhrase('等待用户确认...');
      return;
    }

    // 未激活时不显示短语
    if (!isActive) {
      setCurrentPhrase('');
      return;
    }

    // 随机选择一个短语（首次加载）
    const selectRandomPhrase = () => {
      // 1/6 概率显示实用提示，5/6 概率显示幽默短语
      const showTip = Math.random() < 1 / 6;
      if (showTip) {
        const randomIndex = Math.floor(Math.random() * INFORMATIVE_TIPS.length);
        return INFORMATIVE_TIPS[randomIndex];
      }

      const randomIndex = Math.floor(Math.random() * WITTY_LOADING_PHRASES.length);
      return WITTY_LOADING_PHRASES[randomIndex];
    };

    // 初始化短语
    setCurrentPhrase(selectRandomPhrase());

    // 每 15 秒切换一次
    const intervalId = setInterval(() => {
      setCurrentPhrase(selectRandomPhrase());
    }, PHRASE_CHANGE_INTERVAL_MS);

    return () => {
      clearInterval(intervalId);
    };
  }, [isActive, isWaiting]);

  return currentPhrase;
}
