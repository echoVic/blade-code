# ğŸ”— MCP (Model Context Protocol) æ”¯æŒ

## ğŸ“‹ æ¦‚è¿°

Blade ç°å·²å®Œå…¨æ”¯æŒ Model Context Protocol (MCP)ï¼Œè¿™æ˜¯ä¸€ç§æ ‡å‡†åŒ–åè®®ï¼Œç”¨äºå¤§å‹è¯­è¨€æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ä¹‹é—´å»ºç«‹è¿æ¥ã€‚

### ğŸ¯ ä¸»è¦åŠŸèƒ½

- **MCP å®¢æˆ·ç«¯**ï¼šè¿æ¥åˆ°å¤–éƒ¨ MCP æœåŠ¡å™¨è·å–èµ„æºå’Œå·¥å…·
- **MCP æœåŠ¡å™¨**ï¼šå°† Blade çš„å·¥å…·å’Œèµ„æºæš´éœ²ç»™å…¶ä»–åº”ç”¨ç¨‹åº
- **æ™ºèƒ½é›†æˆ**ï¼šåœ¨ Agent èŠå¤©ä¸­æ— ç¼ä½¿ç”¨ MCP èµ„æº
- **å¤šæœåŠ¡å™¨æ”¯æŒ**ï¼šåŒæ—¶è¿æ¥å¤šä¸ª MCP æœåŠ¡å™¨
- **é…ç½®ç®¡ç†**ï¼šä¾¿æ·çš„æœåŠ¡å™¨é…ç½®å’Œç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ MCP æœåŠ¡å™¨

```bash
# å¯åŠ¨ WebSocket æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£ 3001ï¼‰
blade mcp server start

# è‡ªå®šä¹‰ç«¯å£å’Œåœ°å€
blade mcp server start --port 3002 --host 0.0.0.0

# å¯åŠ¨ Stdio æœåŠ¡å™¨
blade mcp server start --transport stdio
```

### 2. é…ç½® MCP å®¢æˆ·ç«¯

```bash
# æ·»åŠ  WebSocket æœåŠ¡å™¨é…ç½®
blade mcp config add
# æŒ‰æç¤ºè¾“å…¥ï¼š
# - æœåŠ¡å™¨åç§°: my-server
# - ä¼ è¾“æ–¹å¼: WebSocket (ws)
# - WebSocket åœ°å€: ws://localhost:3001

# æ·»åŠ  Stdio æœåŠ¡å™¨é…ç½®
blade mcp config add
# æŒ‰æç¤ºè¾“å…¥ï¼š
# - æœåŠ¡å™¨åç§°: external-tool
# - ä¼ è¾“æ–¹å¼: Standard I/O (stdio)
# - å¯åŠ¨å‘½ä»¤: python mcp_server.py
```

### 3. è¿æ¥å’Œä½¿ç”¨

```bash
# åˆ—å‡ºå·²é…ç½®çš„æœåŠ¡å™¨
blade mcp client list

# è¿æ¥åˆ°æœåŠ¡å™¨
blade mcp client connect my-server

# äº¤äº’å¼æ¢ç´¢æœåŠ¡å™¨
blade mcp client connect my-server --interactive
```

### 4. åœ¨èŠå¤©ä¸­ä½¿ç”¨ MCP

```bash
# å¯ç”¨ MCP çš„èŠå¤©
blade chat --mcp my-server "å¸®æˆ‘æŸ¥çœ‹å½“å‰é¡¹ç›®çŠ¶æ€"

# è¿æ¥å¤šä¸ªæœåŠ¡å™¨
blade chat --mcp my-server external-tool "åˆ†æé¡¹ç›®å¹¶ç”ŸæˆæŠ¥å‘Š"

# ç»“åˆä¸Šä¸‹æ–‡è®°å¿†
blade chat --context --mcp my-server "åŸºäºä¹‹å‰çš„å¯¹è¯ï¼Œæ›´æ–°é¡¹ç›®æ–‡æ¡£"
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨æŒ‡å—

### MCP æœåŠ¡å™¨ç®¡ç†

#### å¯åŠ¨æœåŠ¡å™¨

```bash
# åŸºç¡€å¯åŠ¨
blade mcp server start

# æŒ‡å®šé…ç½®
blade mcp server start \
  --port 3001 \
  --host localhost \
  --transport ws
```

æœåŠ¡å™¨å¯åŠ¨åä¼šæš´éœ²ï¼š
- **èµ„æº**: å·¥ä½œåŒºæ–‡ä»¶ã€Git çŠ¶æ€ã€Git æ—¥å¿—
- **å·¥å…·**: æ‰€æœ‰ Blade å†…ç½®å·¥å…·ï¼ˆ25+ ä¸ªï¼‰
- **æç¤º**: ä»£ç å®¡æŸ¥ã€æ–‡æ¡£ç”Ÿæˆç­‰é¢„å®šä¹‰æç¤º

#### å¯ç”¨èµ„æº

| èµ„æº URI | åç§° | æè¿° |
|----------|------|------|
| `file://workspace` | Current Workspace | å½“å‰å·¥ä½œåŒºæ–‡ä»¶åˆ—è¡¨ |
| `git://status` | Git Status | å½“å‰ Git ä»“åº“çŠ¶æ€ |
| `git://log` | Git Log | æœ€è¿‘çš„ Git æäº¤è®°å½• |

#### å¯ç”¨å·¥å…·

æœåŠ¡å™¨ä¼šæš´éœ² Blade çš„æ‰€æœ‰å†…ç½®å·¥å…·ï¼š

- **æ–‡ä»¶ç³»ç»Ÿå·¥å…·**: è¯»å†™æ–‡ä»¶ã€ç›®å½•æ“ä½œ
- **Git å·¥å…·**: çŠ¶æ€æŸ¥çœ‹ã€æäº¤ã€åˆ†æ”¯ç®¡ç†
- **ç½‘ç»œå·¥å…·**: HTTP è¯·æ±‚ã€URL å¤„ç†
- **æ–‡æœ¬å¤„ç†å·¥å…·**: æœç´¢ã€æ›¿æ¢ã€æ ¼å¼åŒ–
- **æ™ºèƒ½å·¥å…·**: ä»£ç å®¡æŸ¥ã€æ–‡æ¡£ç”Ÿæˆã€æ™ºèƒ½æäº¤
- **å®ç”¨å·¥å…·**: æ—¶é—´æˆ³ã€UUIDã€Base64 ç­‰

### MCP å®¢æˆ·ç«¯ä½¿ç”¨

#### è¿æ¥ç®¡ç†

```bash
# æŸ¥çœ‹è¿æ¥çŠ¶æ€
blade mcp client list

# è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰
blade mcp client connect server-name

# äº¤äº’å¼æ¨¡å¼
blade mcp client connect server-name --interactive
```

#### äº¤äº’å¼æ“ä½œ

åœ¨äº¤äº’å¼æ¨¡å¼ä¸­ï¼Œæ‚¨å¯ä»¥ï¼š

1. **ğŸ“‹ åˆ—å‡ºèµ„æº** - æŸ¥çœ‹å¯ç”¨çš„æ•°æ®æº
2. **ğŸ“– è¯»å–èµ„æº** - è·å–å…·ä½“èµ„æºå†…å®¹
3. **ğŸ”§ åˆ—å‡ºå·¥å…·** - æŸ¥çœ‹å¯ç”¨çš„å·¥å…·
4. **âš¡ è°ƒç”¨å·¥å…·** - æ‰§è¡Œå…·ä½“å·¥å…·æ“ä½œ

### é…ç½®ç®¡ç†

#### æ·»åŠ æœåŠ¡å™¨é…ç½®

```bash
blade mcp config add
```

äº¤äº’å¼é…ç½®å‘å¯¼ä¼šå¼•å¯¼æ‚¨ï¼š
1. è¾“å…¥æœåŠ¡å™¨åç§°
2. é€‰æ‹©ä¼ è¾“æ–¹å¼ï¼ˆWebSocket æˆ– Stdioï¼‰
3. é…ç½®è¿æ¥å‚æ•°

#### ç®¡ç†é…ç½®

```bash
# æ˜¾ç¤ºå½“å‰é…ç½®
blade mcp config show

# ç§»é™¤æœåŠ¡å™¨é…ç½®
blade mcp config remove server-name

# é‡ç½®æ‰€æœ‰é…ç½®
blade mcp config reset
```

#### é…ç½®æ–‡ä»¶

é…ç½®ä¿å­˜åœ¨ `~/.blade/mcp-config.json`ï¼š

```json
{
  "servers": {
    "my-server": {
      "name": "my-server",
      "transport": "ws",
      "endpoint": "ws://localhost:3001",
      "timeout": 10000
    },
    "external-tool": {
      "name": "external-tool",
      "transport": "stdio",
      "command": "python",
      "args": ["mcp_server.py"]
    }
  },
  "client": {
    "timeout": 30000,
    "retryAttempts": 3,
    "retryDelay": 1000
  },
  "server": {
    "port": 3001,
    "host": "localhost",
    "transport": "ws",
    "auth": {
      "enabled": false
    }
  }
}
```

## ğŸ¤– Agent é›†æˆ

### åŸºæœ¬ç”¨æ³•

```bash
# å•æœåŠ¡å™¨æ¨¡å¼
blade chat --mcp my-server "åˆ†æå½“å‰é¡¹ç›®ç»“æ„"

# å¤šæœåŠ¡å™¨æ¨¡å¼
blade chat --mcp server1 server2 "æ•´åˆå¤šä¸ªæ•°æ®æºè¿›è¡Œåˆ†æ"
```

### é«˜çº§ç”¨æ³•

```bash
# ç»“åˆä¸Šä¸‹æ–‡è®°å¿†
blade chat --context --mcp my-server \
  "åŸºäºæˆ‘ä»¬ä¹‹å‰çš„è®¨è®ºï¼Œä½¿ç”¨æœ€æ–°çš„é¡¹ç›®æ•°æ®æ›´æ–°åˆ†ææŠ¥å‘Š"

# æµå¼è¾“å‡º
blade chat --stream --mcp my-server \
  "å®æ—¶åˆ†æé¡¹ç›®çŠ¶æ€å¹¶æä¾›æ”¹è¿›å»ºè®®"

# äº¤äº’å¼èŠå¤©
blade chat --interactive --mcp my-server
```

### Agent ä¸­çš„ MCP èµ„æºè®¿é—®

å½“å¯ç”¨ MCP æ—¶ï¼ŒAgent ä¼šè‡ªåŠ¨ï¼š

1. **è¿æ¥åˆ°æŒ‡å®šæœåŠ¡å™¨** - å»ºç«‹è¿æ¥å¹¶è·å–èµ„æºåˆ—è¡¨
2. **é›†æˆå¤–éƒ¨å·¥å…·** - å°† MCP å·¥å…·æ·»åŠ åˆ°å¯ç”¨å·¥å…·é›†
3. **æ™ºèƒ½èµ„æºé€‰æ‹©** - æ ¹æ®å¯¹è¯å†…å®¹æ™ºèƒ½é€‰æ‹©ç›¸å…³èµ„æº
4. **æ— ç¼å·¥å…·è°ƒç”¨** - åœ¨å¯¹è¯ä¸­è‡ªç„¶è°ƒç”¨ MCP å·¥å…·

## ğŸ”§ å¼€å‘æŒ‡å—

### åˆ›å»ºè‡ªå®šä¹‰ MCP æœåŠ¡å™¨

```python
# ç¤ºä¾‹: Python MCP æœåŠ¡å™¨
import json
import sys
from mcp import MCPServer

server = MCPServer("my-custom-server", "1.0.0")

@server.resource("custom://data")
async def get_custom_data():
    return {
        "uri": "custom://data",
        "mimeType": "application/json",
        "text": json.dumps({"message": "Hello from custom server!"})
    }

@server.tool("custom_tool")
async def custom_tool(params):
    return {
        "content": [{"type": "text", "text": f"Processed: {params}"}],
        "isError": False
    }

if __name__ == "__main__":
    server.run_stdio()
```

### è¿æ¥åˆ°è‡ªå®šä¹‰æœåŠ¡å™¨

```bash
# æ·»åŠ è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®
blade mcp config add
# è¾“å…¥ï¼š
# - åç§°: my-custom
# - ä¼ è¾“: stdio
# - å‘½ä»¤: python my_server.py

# ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å™¨
blade chat --mcp my-custom "ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·å¤„ç†æ•°æ®"
```

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### è®¤è¯å’Œæƒé™

```json
{
  "server": {
    "auth": {
      "enabled": true,
      "tokens": ["your-secret-token"]
    }
  }
}
```

### ç½‘ç»œå®‰å…¨

- é»˜è®¤åªç›‘å¬æœ¬åœ°åœ°å€ (localhost)
- å¯é…ç½® HTTPS/WSS æ”¯æŒ
- æ”¯æŒé˜²ç«å¢™å‹å¥½çš„ç«¯å£é…ç½®

### å·¥å…·æƒé™

- æ‰€æœ‰å·¥å…·è°ƒç”¨éƒ½ç»è¿‡ Blade çš„å®‰å…¨ç¡®è®¤æœºåˆ¶
- æ”¯æŒå·¥å…·çº§åˆ«çš„æƒé™æ§åˆ¶
- è‡ªåŠ¨é£é™©è¯„ä¼°å’Œç”¨æˆ·ç¡®è®¤

## ğŸ“š ä½¿ç”¨åœºæ™¯

### 1. å¼€å‘ç¯å¢ƒé›†æˆ

```bash
# è¿æ¥åˆ°å¼€å‘ç¯å¢ƒçš„ MCP æœåŠ¡å™¨
blade chat --mcp dev-server \
  "æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡å¹¶ç”Ÿæˆæ”¹è¿›å»ºè®®"
```

### 2. æ•°æ®åˆ†ææµæ°´çº¿

```bash
# è¿æ¥åˆ°æ•°æ®åˆ†ææœåŠ¡å™¨
blade chat --mcp data-server analytics-server \
  "åˆ†ææœ€æ–°æ•°æ®å¹¶ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š"
```

### 3. å¤šå·¥å…·åä½œ

```bash
# åŒæ—¶ä½¿ç”¨å†…ç½®å·¥å…·å’Œå¤–éƒ¨å·¥å…·
blade chat --mcp external-api \
  "ä½¿ç”¨å†…ç½®å·¥å…·åˆ†æä»£ç ï¼Œç„¶åé€šè¿‡å¤–éƒ¨ API ç”Ÿæˆæ–‡æ¡£"
```

### 4. æŒç»­é›†æˆ

```bash
# åœ¨ CI/CD ä¸­ä½¿ç”¨
blade chat --mcp ci-server \
  "åˆ†ææ„å»ºç»“æœå¹¶æä¾›ä¼˜åŒ–å»ºè®®"
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æœåŠ¡å™¨é…ç½®

- ä¸ºä¸åŒç¯å¢ƒé…ç½®ä¸åŒçš„æœåŠ¡å™¨ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰
- ä½¿ç”¨æè¿°æ€§çš„æœåŠ¡å™¨åç§°
- å®šæœŸæ£€æŸ¥å’Œæ›´æ–°æœåŠ¡å™¨é…ç½®

### 2. èµ„æºç®¡ç†

- åˆç†ç»„ç»‡èµ„æº URI
- æä¾›æ¸…æ™°çš„èµ„æºæè¿°
- å®æ–½é€‚å½“çš„è®¿é—®æ§åˆ¶

### 3. å·¥å…·è®¾è®¡

- ä¿æŒå·¥å…·åŠŸèƒ½å•ä¸€ä¸”ä¸“æ³¨
- æä¾›è¯¦ç»†çš„å·¥å…·æè¿°å’Œå‚æ•°è¯´æ˜
- å®æ–½é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 4. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨è¿æ¥æ± ç®¡ç†å¤šä¸ªè¿æ¥
- å®æ–½é€‚å½“çš„ç¼“å­˜ç­–ç•¥
- ç›‘æ§è¿æ¥çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
blade mcp server start

# éªŒè¯é…ç½®
blade mcp config show

# æµ‹è¯•è¿æ¥
blade mcp client connect server-name
```

#### å·¥å…·è°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥å·¥å…·æ˜¯å¦å¯ç”¨
blade mcp client connect server-name --interactive
# é€‰æ‹© "åˆ—å‡ºå·¥å…·"

# éªŒè¯å‚æ•°æ ¼å¼
blade tools info tool-name
```

#### æ€§èƒ½é—®é¢˜
```bash
# è°ƒæ•´è¶…æ—¶è®¾ç½®
blade mcp config show
# æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ä¸­çš„ timeout å€¼
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
blade chat --mcp server-name --debug "æµ‹è¯•è¿æ¥"
```

## ğŸ“ˆ æœªæ¥è§„åˆ’

### å³å°†æ¨å‡ºçš„åŠŸèƒ½

- **SSE ä¼ è¾“æ”¯æŒ** - æ”¯æŒ Server-Sent Events ä¼ è¾“
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡èµ„æºè¯»å–å’Œå·¥å…·è°ƒç”¨
- **äº‹ä»¶è®¢é˜…** - æ”¯æŒèµ„æºå˜æ›´çš„å®æ—¶é€šçŸ¥
- **é«˜çº§è®¤è¯** - OAuth 2.0 å’Œ JWT ä»¤ç‰Œæ”¯æŒ
- **é›†ç¾¤æ”¯æŒ** - å¤šèŠ‚ç‚¹ MCP æœåŠ¡å™¨é›†ç¾¤
- **ç›‘æ§é¢æ¿** - Web ç•Œé¢çš„ MCP çŠ¶æ€ç›‘æ§

### ç¤¾åŒºè´¡çŒ®

æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼š
- MCP æœåŠ¡å™¨å®ç°
- å·¥å…·æ‰©å±•
- æ–‡æ¡£æ”¹è¿›
- é”™è¯¯æŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [MCP å®˜æ–¹è§„èŒƒ](https://spec.modelcontextprotocol.io/)
- [Blade å·¥å…·æ–‡æ¡£](./å·¥å…·ç³»ç»Ÿ.md)
- [Agent ä½¿ç”¨æŒ‡å—](./Agentä½¿ç”¨æŒ‡å—.md)
- [é…ç½®ç®¡ç†](./é…ç½®ç®¡ç†.md)

---

é€šè¿‡ MCP æ”¯æŒï¼ŒBlade æˆä¸ºäº†ä¸€ä¸ªçœŸæ­£å¼€æ”¾å’Œå¯æ‰©å±•çš„ AI åŠ©æ‰‹å¹³å°ï¼Œèƒ½å¤Ÿæ— ç¼é›†æˆå„ç§å¤–éƒ¨èµ„æºå’Œå·¥å…·ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¼ºå¤§çš„ AI åä½œä½“éªŒã€‚ 